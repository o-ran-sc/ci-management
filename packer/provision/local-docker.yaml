# This Ansible playbook adds packages to the
# O-RAN-SC build minion image that has Docker.
---
- import_playbook: ../common-packer/provision/docker.yaml

- hosts: all
  become_user: root
  become_method: sudo

  vars:
    golang_version: 1.12

  pre_tasks:
    - include_role: name=lfit.system-update

  tasks:
    - include_role:
        name: geerlingguy.ruby
      vars:
        ruby_install_gems:
          - rake
        ruby_install_bundler: false
        ruby_install_from_source: true
        ansible_become: true

    - name: 'Install PackageCloud'
      command: 'gem install package_cloud'
      become: true

    - include_role:
        name: gantsign.golang
      vars:
        ansible_become: true

    - name: Add Go to Ubuntu path
      blockinfile:
        path: /etc/bash.bashrc
        block: |
          if [ -d /etc/profile.d ]; then
            for i in /etc/profile.d/*.sh; do
              if [ -r $i ]; then
                . $i
              fi
            done
            unset i
          fi
      when: ansible_distribution == 'Ubuntu'
      become: yes
